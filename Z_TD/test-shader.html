<!DOCTYPE html>
<html>
<head>
    <title>Shader Test</title>
    <style>
        body { margin: 0; padding: 20px; background: #222; color: white; font-family: Arial; }
        #container { width: 800px; height: 600px; border: 2px solid #666; }
        button { margin: 5px; padding: 10px; background: #444; color: white; border: 1px solid #666; cursor: pointer; }
        button:hover { background: #555; }
    </style>
</head>
<body>
    <h1>Shader Test</h1>
    <div>
        <button onclick="testShader('none')">None</button>
        <button onclick="testShader('test')">Test (Red Tint)</button>
        <button onclick="testShader('crt')">CRT</button>
        <button onclick="testShader('pixelation')">Pixelation</button>
    </div>
    <div id="container"></div>

    <script type="module">
        import { Application, Graphics, Container } from 'https://cdn.skypack.dev/pixi.js@8.8.1';

        // Create PIXI app
        const app = new Application();
        await app.init({ width: 800, height: 600, backgroundColor: 0x1099bb });
        document.getElementById('container').appendChild(app.canvas);

        // Create some test content
        const graphics = new Graphics();
        graphics.rect(50, 50, 100, 100).fill({ color: 0xff0000 });
        graphics.rect(200, 50, 100, 100).fill({ color: 0x00ff00 });
        graphics.rect(350, 50, 100, 100).fill({ color: 0x0000ff });
        graphics.rect(50, 200, 100, 100).fill({ color: 0xffff00 });
        graphics.rect(200, 200, 100, 100).fill({ color: 0xff00ff });
        graphics.rect(350, 200, 100, 100).fill({ color: 0x00ffff });
        app.stage.addChild(graphics);

        // Test shader function
        window.testShader = function(type) {
            console.log('Testing shader:', type);
            
            // Clear existing filters
            app.stage.filters = null;
            
            if (type === 'test') {
                // Simple red tint shader
                const vertexShader = `
                    attribute vec2 aVertexPosition;
                    attribute vec2 aTextureCoord;
                    uniform mat3 projectionMatrix;
                    varying vec2 vTextureCoord;
                    void main(void) {
                        gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
                        vTextureCoord = aTextureCoord;
                    }
                `;
                
                const fragmentShader = `
                    precision mediump float;
                    varying vec2 vTextureCoord;
                    uniform sampler2D uSampler;
                    uniform float redTint;
                    void main(void) {
                        vec4 color = texture2D(uSampler, vTextureCoord);
                        color.r += redTint;
                        color = clamp(color, 0.0, 1.0);
                        gl_FragColor = color;
                    }
                `;
                
                try {
                    const { Filter, GlProgram } = await import('https://cdn.skypack.dev/pixi.js@8.8.1');
                    
                    const glProgram = GlProgram.from({
                        vertex: vertexShader,
                        fragment: fragmentShader,
                    });
                    
                    const filter = new Filter({
                        glProgram,
                        resources: {
                            redTint: { value: 0.3, type: 'f32' }
                        }
                    });
                    
                    app.stage.filters = [filter];
                    console.log('Red tint filter applied successfully!');
                } catch (error) {
                    console.error('Error creating filter:', error);
                }
            }
        };
    </script>
</body>
</html>